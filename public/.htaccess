RewriteEngine On
RewriteBase /

# 1. PASSENGER BACKEND (Critical)
# Do not rewrite /app requests. Let Passenger handle them.
RewriteRule ^app - [L]

# 2. TRAILING SLASH ENFORCEMENT
# If it's a directory but missing slash, redirect.
# This helps Apache find the index.html via DirectoryIndex.
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^(.*[^/])$ /$1/ [R=301,L]

# 3. DIRECTORY INDEX
# Ensure Apache looks for index.html (standard behavior, but being explicit helps)
DirectoryIndex index.html

# 4. STANDARD FILE SERVING
# If file exists, serve it.
RewriteCond %{REQUEST_FILENAME} -f
RewriteRule ^ - [L]

# 5. SPA / 404 FALLBACK
# If request is not a file and not a directory, show 404 or index.html
# Since this is a static site with subpages, we prefer 404 for missing pages
# rather than redirecting everything to home (which confuses invalid links).
ErrorDocument 404 /404.html
